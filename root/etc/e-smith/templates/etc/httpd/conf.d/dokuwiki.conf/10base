{

if (($dokuwiki{'status'} || 'disabled') eq 'enabled'){
    my $allow = (($dokuwiki{'access'} || 'private') eq 'public') ? 'all':"$localAccess";
    my $maxsize = $dokuwiki{'MaxUploadSize'} || '200';
    $maxsize .= 'M' unless ($maxsize =~ m/M$/);
    my $memory = $maxsize*2


$OUT .= "Alias /dokuwiki /usr/share/dokuwiki";

if (exists $dokuwiki{'URL'})
    {
        $OUT .= "Alias /$dokuwiki{'URL'} /usr/share/dokuwiki";
    }
 
    $OUT .=<<"EOF";

<Directory /usr/share/dokuwiki>
    SSLRequireSSL on
    AllowOverride None
    Options +FollowSymlinks
    AddType application/x-httpd-php .php
    Order Allow,Deny
    Allow from $allow
    php_admin_value open_basedir /usr/share/dokuwiki:/var/lib/dokuwiki:/etc/dokuwiki
    php_admin_value memory_limit $memory
    php_admin_value upload_max_filesize $maxsize
    php_admin_value post_max_size $maxsize
    php_admin_value upload_tmp_dir /var/lib/dokuwiki/data/tmp
    php_admin_value session.save_path /var/lib/dokuwiki/data/tmp
</Directory>

<Directory /usr/share/dokuwiki/inc>
    Order Deny,Allow
    Deny from all
</Directory>

<Directory /usr/share/dokuwiki/inc/lang>
    Order Deny,Allow
    Deny from all
</Directory>

<Directory /usr/share/dokuwiki/lib/_fla>
    ## no access to the fla directory
    Order allow,deny
    Deny from all
</Directory>

## no access to the conf directory
<Directory /etc/dokuwiki>
    Order allow,deny
    Deny from all
</Directory>
<Directory /usr/share/dokuwiki/conf>
    Order allow,deny
    Deny from all
</Directory>

## no access to the data directory
<Directory /usr/share/dokuwiki/data>
    Order allow,deny
    Deny from all
</Directory>
<Directory /var/lib/dokuwiki>
    Order allow,deny
    Deny from all
</Directory>


EOF

}
else {
    $OUT .=<<'EOF';

# Dokuwiki is disabled
# You can enable it with
# db configuration setprop dokuwiki status enabled
# signal-event webapps-update

EOF
}

}

